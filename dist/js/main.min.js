"use strict";var team9WatermarkGeneratorModule=function(){function e(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}function t(e){var t=e.data("coord"),a=parseInt(e.data("step"));"x"===t?o+a>-1&&f+1>o+a&&(o+=a,s.val(o),n.css({left:o+"px"})):"y"===t&&i+a>-1&&g+1>i+a&&(i+=a,r.val(i),n.css({top:i+"px"}))}var n=$(".watermark__img-wrapper"),a=$(".wrapper__img-resize"),o=parseInt(n.css("left").slice(0,-2)),i=parseInt(n.css("top").slice(0,-2)),s=$(".boxBlock__controls-input-left"),r=$(".boxBlock__controls-input-top"),l=$(".move__input"),u=$(".choose__style"),c=0,p=0,m=0,d=0,f=m-c,g=d-p,h=function(){$(".btn_reset").on("click",x),$("#main-file").on("change",k),$("#water-file").on("change",C),l.on("change",M),u.on("click",B)},v=function(){T(),b(),w(),_(),$(".slider").length&&I()},w=function(){$("#main-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit()},done:function(e,t){var n=t.result.files[0],a=$("<img></img>");$(".img-upload").remove(),a.attr("src",n.url),a.addClass("img-upload"),a.fadeIn(".wrapper__img-resize"),$(".wrapper__img-resize").append(a),a.load(function(){var e=$(this).width(),t=$(this).height(),n=$(".main__content").height(),o=$(".main__content").width(),i=o/n,s=function(e,t,n){a.addClass(e),$(".wrapper__img-resize").css({height:t+"px",width:n+"px","margin-top":-t/2})};o>e&&n>t?s("",t,e):e/t>i?s("img-upload-widthR ",Math.round(o*t/e),o):s("img-upload-heightR ",n,Math.round(n*e/t)),y()})}})},_=function(){$("#water-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit()},done:function(e,t){var n=t.result.files[0],a=$(".watermark__img-wrapper"),o=$("<img></img>");o.attr("src",n.url),o.addClass("img-watermark"),o.fadeIn(".watermark__img-wrapper"),a.html(o),o.load(function(){var e=$(this).width(),t=$(this).height(),n=$(".main__content").height(),i=$(".main__content").width(),s=i/n,r=function(e,t,n){o.addClass(e),a.css({height:t+"px",width:n+"px"})};i>e&&n>t?r("",t,e):e/t>s?r("img-upload-widthR ",Math.round(i*t/e),i):r("img-upload-heightR ",n,Math.round(n*e/t)),y()})}})},y=function(){c=parseInt(n.css("width").slice(0,-2)),p=parseInt(n.css("height").slice(0,-2)),m=parseInt(a.css("width").slice(0,-2)),d=parseInt(a.css("height").slice(0,-2)),f=m-c,g=d-p},x=function(){$(".img-upload").remove(),$(".img-watermark").remove(),$(".wrapper__img-resize").removeAttr("style"),$(".watermark__img-wrapper").removeAttr("style"),document.getElementsByClassName("ui-slider-handle")[1].style.left="100%",document.getElementsByClassName("ui-slider-range")[0].style.width="100%";for(var e=document.getElementsByClassName("choose__input"),t=0;t<e.length;t++)e[t].checked=!1;o=0,i=0,s.val(o),r.val(i),n.css({left:o+"px"}),n.css({top:i+"px"}),n.css({opacity:"1"})},I=function(){$(".slider").slider({range:!0,min:parseInt($(".slider").data("min")),max:parseInt($(".slider").data("max")),step:.01,values:[0,1]});var e=document.getElementsByClassName("ui-slider-range"),t=document.getElementsByClassName("ui-slider-handle"),n=1,a=$("#blockToMove");t[1].onmousedown=function(){var t;return t=window.setInterval(function(){n=e[0].style.width.slice(0,-1)/100,a.css({opacity:n})},50),document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,n=e[0].style.width.slice(0,-1)/100,a.css({opacity:n}),clearTimeout(t)},!1}},k=function(e){e.preventDefault();var t=$(this),n=t.val();$("#main-text").val(n.replace(/C:\\fakepath\\/,""))},C=function(e){e.preventDefault();var t=$(this),n=t.val();$("#water-text").val(n.replace(/C:\\fakepath\\/,""))},M=function(e){var t=$(this),a=t.data("coord"),s=parseInt(t.val());isNaN(s)&&(s=0),t.val(s),"x"===a&&(0>s?t.val(0):s>f&&t.val(f),s=t.val(),o=parseInt(s),n.css({left:o+"px"})),"y"===a&&(0>s?t.val(0):s>g&&t.val(g),s=t.val(),i=parseInt(s),n.css({top:i+"px"}))},B=function(e){var t=$(this),a=t.data("x"),l=t.data("y");1===a&&(o=0),1===l&&(i=0),2===a&&(o=Math.floor(f/2)),2===l&&(i=Math.floor(g/2)),3===a&&(o=f),3===l&&(i=g),s.val(o),n.css({left:o+"px"}),r.val(i),n.css({top:i+"px"})},T=function(){var t=document.getElementById("blockToMove"),n=document.getElementById("dragWrapper"),a=e(n);t.onmousedown=function(n){var l=e(t),u=n.pageX-l.left,c=n.pageY-l.top;document.onmousemove=function(e){o=e.pageX-u-a.left,i=e.pageY-c-a.top,0>o&&(o=0),o>f&&(o=f),0>i&&(i=0),i>g&&(i=g),o=Math.floor(o),i=Math.floor(i),t.style.left=o+"px",t.style.top=i+"px",s.val(o),r.val(i)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},t.ondragstart=function(){return!1}},b=function(){for(var e,n,a=document.getElementsByClassName("arrow__controls"),o=0;o<a.length;o++)a[o].onclick=function(e){e.preventDefault(),t($(this))},a[o].onmousedown=function(a){a.preventDefault();var o=$(this);e=window.setTimeout(function(){n=window.setInterval(function(){t(o)},20)},375),document.onmouseup=function(){clearTimeout(n),clearTimeout(e),document.onmouseup=null}}};return{init:function(){h(),v()}}}();team9WatermarkGeneratorModule.init();