"use strict";var team9WatermarkGeneratorModule=function(){function e(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}function t(e){var t=e.data("coord"),n=parseInt(e.data("step"));"x"===t?o+n>-1&&h+1>o+n&&(o+=n,i.val(o),a.css({left:o+"px"})):"y"===t&&s+n>-1&&v+1>s+n&&(s+=n,r.val(s),a.css({top:s+"px"}))}var a=$(".watermark__img-wrapper"),n=$(".wrapper__img-resize"),o=parseInt(a.css("left").slice(0,-2)),s=parseInt(a.css("top").slice(0,-2)),i=$(".boxBlock__controls-input-left"),r=$(".boxBlock__controls-input-top"),l=$(".move__input"),u=$(".choose__style"),c=1,d=0,p=0,m=0,f=0,h=m-d,v=f-p,g=function(){$(".btn_reset").on("click",y),$("#main-file").on("change",I),$("#water-file").on("change",B),l.on("change",M),u.on("click",T)},_=function(){E(),N(),w(),b(),$(".slider").length&&C()},w=function(){$("#main-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("#water-file").attr("disabled",!1),$(".sidebar__form-label_file").removeClass("ui-state-disabled"),$("#water-text").removeClass("ui-state-disabled")},done:function(e,t){var a=t.result.files[0],o=$("<img></img>");$(".img-upload").remove(),o.attr("src",a.url),o.addClass("img-upload"),o.fadeIn(".wrapper__img-resize"),$(".wrapper__img-resize").append(o),o.load(function(){var e=$(this).width(),t=$(this).height(),a=$(".main__content").height(),s=$(".main__content").width(),i=function(e,t,a){o.addClass(e),$(".wrapper__img-resize").css({height:t+"px",width:a+"px","margin-top":-t/2})};s>=e&&a>=t?i("",t,e):e>s&&t>a?e>t?(i("img-upload-both-heightR ",Math.round(t*(s/e)),s),c=s/e):(i("img-upload-both-widthR ",a,Math.round(e*(a/t))),c=a/t):e>s&&a>t?(i("img-upload-heightR",Math.round(t*(s/e)),s),c=s/e):(i("img-upload-widthR ",a,Math.round(e*(a/t))),c=a/t),n.data("koef",c).attr("data-koef",c),x()})}})},b=function(){$("#water-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("input").attr("disabled",!1),$(".choose").removeClass("ui-state-disabled"),$(".btn").removeClass("ui-state-disabled"),$(".move__input").removeClass("ui-state-disabled"),$(".arrow__controls").removeClass("ui-state-disabled"),$(".arrow_top").addClass("arrow_top_hover"),$(".arrow_bot").addClass("arrow_bot_hover"),k()},done:function(e,t){var a=t.result.files[0],n=$(".watermark__img-wrapper"),o=$("<img></img>");o.attr("src",a.url),o.addClass("img-watermark"),o.fadeIn(".watermark__img-wrapper"),n.html(o),o.load(function(){var e=$(this)[0].naturalWidth,t=$(this)[0].naturalHeight,a=$(".wrapper__img-resize").height(),s=$(".wrapper__img-resize").width(),i=a*(1/c),r=s*(1/c),l=function(e,t,a,s){o.addClass(e),n.css({height:Math.round(t*s)+"px",width:Math.round(a*s)+"px"})};r>e&&i>t?l("",t,e,c):l("",t,e,c/2),x()})}})},x=function(){d=parseInt(a.css("width").slice(0,-2)),p=parseInt(a.css("height").slice(0,-2)),m=parseInt(n.css("width").slice(0,-2)),f=parseInt(n.css("height").slice(0,-2)),h=m-d,v=f-p,o=0,s=0,i.val(o),a.css({left:o+"px"}),r.val(s),a.css({top:s+"px"}),document.getElementsByClassName("choose__input")[0].checked=!0},y=function(){document.getElementsByClassName("ui-slider-handle")[1].style.left="100%",document.getElementsByClassName("ui-slider-range")[0].style.width="100%";for(var e=document.getElementsByClassName("choose__input"),t=0;t<e.length;t++)e[t].checked=!1;o=0,s=0,i.val(o),r.val(s),a.css({left:o+"px"}),a.css({top:s+"px"}),a.css({opacity:"1"})},k=function(){$(".slider").slider({disabled:!1})},C=function(){$(".slider").slider({range:!0,disabled:!0,min:parseInt($(".slider").data("min")),max:parseInt($(".slider").data("max")),step:.01,values:[0,1]});var e=document.getElementsByClassName("ui-slider-range"),t=document.getElementsByClassName("ui-slider-handle"),a=1,n=$("#blockToMove");t[1].onmousedown=function(){var t;return t=window.setInterval(function(){a=e[0].style.width.slice(0,-1)/100,n.css({opacity:a})},50),document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a=e[0].style.width.slice(0,-1)/100,n.css({opacity:a}),clearTimeout(t)},!1}},I=function(e){e.preventDefault();var t=$(this),a=t.val();$("#main-text").val(a.replace(/C:\\fakepath\\/,""))},B=function(e){e.preventDefault();var t=$(this),a=t.val();$("#water-text").val(a.replace(/C:\\fakepath\\/,""))},M=function(e){var t=$(this),n=t.data("coord"),i=parseInt(t.val());isNaN(i)&&(i=0),t.val(i),"x"===n&&(0>i?t.val(0):i>h&&t.val(h),i=t.val(),o=parseInt(i),a.css({left:o+"px"})),"y"===n&&(0>i?t.val(0):i>v&&t.val(v),i=t.val(),s=parseInt(i),a.css({top:s+"px"}))},T=function(e){var t=$(this),n=t.data("x"),l=t.data("y");1===n&&(o=0),1===l&&(s=0),2===n&&(o=Math.floor(h/2)),2===l&&(s=Math.floor(v/2)),3===n&&(o=h),3===l&&(s=v),i.val(o),a.css({left:o+"px"}),r.val(s),a.css({top:s+"px"})},E=function(){var t=document.getElementById("blockToMove"),a=document.getElementById("dragWrapper");e(a);t.onmousedown=function(n){var l=e(t),u=e(a),c=n.pageX-l.left,d=n.pageY-l.top;document.onmousemove=function(e){o=e.pageX-c-u.left,s=e.pageY-d-u.top,0>o&&(o=0),o>h&&(o=h),0>s&&(s=0),s>v&&(s=v),o=Math.floor(o),s=Math.floor(s),t.style.left=o+"px",t.style.top=s+"px",i.val(o),r.val(s)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},t.ondragstart=function(){return!1}},N=function(){for(var e,a,n=document.getElementsByClassName("arrow__controls"),o=0;o<n.length;o++)n[o].onclick=function(e){e.preventDefault(),t($(this))},n[o].onmousedown=function(n){n.preventDefault();var o=$(this);e=window.setTimeout(function(){a=window.setInterval(function(){t(o)},20)},375),document.onmouseup=function(){clearTimeout(a),clearTimeout(e),document.onmouseup=null}}};return{init:function(){g(),_()}}}(),DownloadWatermark=function(){var e=function(){$(".btn_submit").on("click",t)},t=function(e){a()},a=function(){var e=n();$.ajax({type:"POST",data:e,url:"server/php/downloads.php",dataType:"json",async:!1,success:function(e){var t="?download";$(".btn_submit").attr("href","server/php/files/out/"+e.name+t)}})},n=function(){return{mainImage:$("#main-text").val(),watermark:$("#water-text").val(),coordX:$(".boxBlock__controls-input-left").val(),coordY:$(".boxBlock__controls-input-top").val(),opacity:$(".watermark__img-wrapper").css("opacity")}};return{init:function(){e()}}}();DownloadWatermark.init(),team9WatermarkGeneratorModule.init();