"use strict";var team9WatermarkGeneratorModule=function(){function e(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}function t(e){var t=e.data("coord"),o=parseInt(e.data("step"));"x"===t?s+o>-1&&v+1>s+o&&(s+=o,r.val(s),a.css({left:s+"px"})):"y"===t&&n+o>-1&&h+1>n+o&&(n+=o,i.val(n),a.css({top:n+"px"}))}var a=$(".watermark__img-wrapper"),o=$(".wrapper__img-resize"),s=parseInt(a.css("left").slice(0,-2)),n=parseInt(a.css("top").slice(0,-2)),r=$(".boxBlock__controls-input-left"),i=$(".boxBlock__controls-input-top"),l=$(".move__input"),d=$(".choose__style"),u=1,c=0,p=0,m=0,f=0,v=m-c,h=f-p,g=function(){$(".btn_reset").on("click",y),$("#main-file").on("change",I),$("#water-file").on("change",B),l.on("change",M),d.on("click",T)},_=function(){z(),E(),w(),b(),$(".slider").length&&k()},w=function(){$("#main-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("#water-file").attr("disabled",!1),$(".sidebar__form-label_file").removeClass("ui-state-disabled"),$("#water-text").removeClass("ui-state-disabled")},done:function(e,t){var a=t.result.files[0],s=$("<img></img>");$(".img-upload").remove(),s.attr("src",a.url),s.addClass("img-upload"),s.fadeIn(".wrapper__img-resize"),$(".wrapper__img-resize").append(s),s.load(function(){var e=$(this).width(),t=$(this).height(),a=$(".main__content").height(),n=$(".main__content").width(),r=function(e,t,a){s.addClass(e),$(".wrapper__img-resize").css({height:t+"px",width:a+"px","margin-top":-t/2})};n>=e&&a>=t?r("",t,e):e>n&&t>a?e>t?(r("img-upload-both-heightR ",Math.round(t*(n/e)),n),u=n/e):(r("img-upload-both-widthR ",a,Math.round(e*(a/t))),u=a/t):e>n&&a>t?(r("img-upload-heightR",Math.round(t*(n/e)),n),u=n/e):(r("img-upload-widthR ",a,Math.round(e*(a/t))),u=a/t),o.data("koef",u).attr("data-koef",u),x()})}})},b=function(){$("#water-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("input").attr("disabled",!1),$(".choose").removeClass("ui-state-disabled"),$(".btn").removeClass("ui-state-disabled"),$(".move__input").removeClass("ui-state-disabled"),$(".arrow__controls").removeClass("ui-state-disabled"),$(".arrow_top").addClass("arrow_top_hover"),$(".arrow_bot").addClass("arrow_bot_hover"),C()},done:function(e,t){var a=t.result.files[0],o=$(".watermark__img-wrapper"),s=$("<img></img>");s.attr("src",a.url),s.addClass("img-watermark"),s.fadeIn(".watermark__img-wrapper"),o.html(s),s.load(function(){var e=$(this)[0].naturalWidth,t=$(this)[0].naturalHeight,a=$(".wrapper__img-resize").height(),n=$(".wrapper__img-resize").width(),r=a*(1/u),i=n*(1/u),l=function(e,t,a,n){s.addClass(e),o.css({height:Math.round(t*n)+"px",width:Math.round(a*n)+"px"})};i>e&&r>t?l("",t,e,u):l("",t,e,u/2),x()})}})},x=function(){c=parseInt(a.css("width").slice(0,-2)),p=parseInt(a.css("height").slice(0,-2)),m=parseInt(o.css("width").slice(0,-2)),f=parseInt(o.css("height").slice(0,-2)),v=m-c,h=f-p,s=0,n=0,r.val(s),a.css({left:s+"px"}),i.val(n),a.css({top:n+"px"}),document.getElementsByClassName("choose__input")[0].checked=!0},y=function(){$(".img-upload").remove(),$(".img-watermark").remove(),$(".wrapper__img-resize").removeAttr("style"),$(".watermark__img-wrapper").removeAttr("style"),k(),$("#main-text").val(""),$("#main-file").val(""),$("#water-text").val(""),$("#water-file").val(""),$("#water-text").attr("disabled",!0),$("#water-text").addClass("ui-state-disabled"),$("#water-file").attr("disabled",!0),$("#water-file-label").addClass("ui-state-disabled"),$(".choose").addClass("ui-state-disabled"),$(".choose__input").attr("disabled",!0),$(".btn_submit").addClass("ui-state-disabled"),$(".move__input").addClass("ui-state-disabled"),$(".arrow__controls").addClass("ui-state-disabled"),$(".arrow_top").removeClass("arrow_top_hover"),$(".arrow_bot").removeClass("arrow_bot_hover"),document.getElementsByClassName("ui-slider-handle")[1].style.left="100%",document.getElementsByClassName("ui-slider-range")[0].style.width="100%";for(var e=document.getElementsByClassName("choose__input"),t=0;t<e.length;t++)e[t].checked=!1;s=0,n=0,r.val(s),i.val(n),a.css({left:s+"px"}),a.css({top:n+"px"}),a.css({opacity:"1"})},C=function(){$(".slider").slider({disabled:!1})},k=function(){$(".slider").slider({range:!0,disabled:!0,min:parseInt($(".slider").data("min")),max:parseInt($(".slider").data("max")),step:.01,values:[0,1]});var e=document.getElementsByClassName("ui-slider-range"),t=document.getElementsByClassName("ui-slider-handle"),a=1,o=$("#blockToMove");t[1].onmousedown=function(){var t;return t=window.setInterval(function(){a=e[0].style.width.slice(0,-1)/100,o.css({opacity:a})},50),document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a=e[0].style.width.slice(0,-1)/100,o.css({opacity:a}),clearTimeout(t)},!1}},I=function(e){e.preventDefault();var t=$(this),a=t.val();$("#main-text").val(a.replace(/C:\\fakepath\\/,""))},B=function(e){e.preventDefault();var t=$(this),a=t.val();$("#water-text").val(a.replace(/C:\\fakepath\\/,""))},M=function(e){var t=$(this),o=t.data("coord"),r=parseInt(t.val());isNaN(r)&&(r=0),t.val(r),"x"===o&&(0>r?t.val(0):r>v&&t.val(v),r=t.val(),s=parseInt(r),a.css({left:s+"px"})),"y"===o&&(0>r?t.val(0):r>h&&t.val(h),r=t.val(),n=parseInt(r),a.css({top:n+"px"}))},T=function(e){var t=$(this),o=t.data("x"),l=t.data("y");1===o&&(s=0),1===l&&(n=0),2===o&&(s=Math.floor(v/2)),2===l&&(n=Math.floor(h/2)),3===o&&(s=v),3===l&&(n=h),r.val(s),a.css({left:s+"px"}),i.val(n),a.css({top:n+"px"})},z=function(){var t=document.getElementById("blockToMove"),a=document.getElementById("dragWrapper"),o=e(a);t.onmousedown=function(a){var l=e(t),d=a.pageX-l.left,u=a.pageY-l.top;document.onmousemove=function(e){s=e.pageX-d-o.left,n=e.pageY-u-o.top,0>s&&(s=0),s>v&&(s=v),0>n&&(n=0),n>h&&(n=h),s=Math.floor(s),n=Math.floor(n),t.style.left=s+"px",t.style.top=n+"px",r.val(s),i.val(n)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},t.ondragstart=function(){return!1}},E=function(){for(var e,a,o=document.getElementsByClassName("arrow__controls"),s=0;s<o.length;s++)o[s].onclick=function(e){e.preventDefault(),t($(this))},o[s].onmousedown=function(o){o.preventDefault();var s=$(this);e=window.setTimeout(function(){a=window.setInterval(function(){t(s)},20)},375),document.onmouseup=function(){clearTimeout(a),clearTimeout(e),document.onmouseup=null}}};return{init:function(){g(),_()}}}(),DownloadWatermark=function(){var e=function(){$(".btn_submit").on("click",t)},t=function(e){a()},a=function(){var e=o();$.ajax({type:"POST",data:e,url:"server/php/downloads.php",dataType:"json",async:!1,success:function(e){var t="?download";$(".btn_submit").attr("href","server/php/files/out/"+e.name+t)}})},o=function(){return{mainImage:$("#main-text").val(),watermark:$("#water-text").val(),coordX:$(".boxBlock__controls-input-left").val(),coordY:$(".boxBlock__controls-input-top").val(),opacity:$(".watermark__img-wrapper").css("opacity")}};return{init:function(){e()}}}();DownloadWatermark.init(),team9WatermarkGeneratorModule.init();