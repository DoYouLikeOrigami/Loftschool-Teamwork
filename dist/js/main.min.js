"use strict";var team9WatermarkGeneratorModule=function(){function e(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}function t(e){var t=e.data("coord"),s=parseInt(e.data("step"));"x"===t?n+s>-1&&f+1>n+s&&(n+=s,o.val(n),a.css({left:n+"px"})):"y"===t&&i+s>-1&&g+1>i+s&&(i+=s,l.val(i),a.css({top:i+"px"}))}var a=$(".watermark__img-wrapper"),s=$(".wrapper__img-resize"),n=parseInt(a.css("left").slice(0,-2)),i=parseInt(a.css("top").slice(0,-2)),o=$(".boxBlock__controls-input-left"),l=$(".boxBlock__controls-input-top"),r=$(".move__input"),d=$(".choose__style"),u=0,c=0,m=0,p=0,f=m-u,g=p-c,v=function(){$(".btn_reset").on("click",x),$("#main-file").on("change",I),$("#water-file").on("change",k),r.on("change",B),d.on("click",M)},h=function(){E(),N(),_(),w(),$(".slider").length&&C()},_=function(){$("#main-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("#water-file").attr("disabled",!1),$(".sidebar__form-label_file").removeClass("ui-state-disabled"),$("#water-text").removeClass("ui-state-disabled")},done:function(e,t){var a=t.result.files[0],s=$("<img></img>");$(".img-upload").remove(),s.attr("src",a.url),s.addClass("img-upload"),s.fadeIn(".wrapper__img-resize"),$(".wrapper__img-resize").append(s),s.load(function(){var e=$(this).width(),t=$(this).height(),a=$(".main__content").height(),n=$(".main__content").width(),i=n/a,o=function(e,t,a){s.addClass(e),$(".wrapper__img-resize").css({height:t+"px",width:a+"px","margin-top":-t/2})};n>e&&a>t?o("",t,e):e/t>i?o("img-upload-widthR ",Math.round(n*t/e),n):o("img-upload-heightR ",a,Math.round(a*e/t)),b()})}})},w=function(){$("#water-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("input").attr("disabled",!1),$(".choose").removeClass("ui-state-disabled"),$(".btn").removeClass("ui-state-disabled"),$(".move__input").removeClass("ui-state-disabled"),$(".arrow__controls").removeClass("ui-state-disabled"),y()},done:function(e,t){var a=t.result.files[0],s=$(".watermark__img-wrapper"),n=$("<img></img>");n.attr("src",a.url),n.addClass("img-watermark"),n.fadeIn(".watermark__img-wrapper"),s.html(n),n.load(function(){var e=$(this).width(),t=$(this).height(),a=$(".main__content").height(),i=$(".main__content").width(),o=i/a,l=function(e,t,a){n.addClass(e),s.css({height:t+"px",width:a+"px"})};i>e&&a>t?l("",t,e):e/t>o?l("img-upload-widthR ",Math.round(i*t/e),i):l("img-upload-heightR ",a,Math.round(a*e/t)),b()})}})},b=function(){u=parseInt(a.css("width").slice(0,-2)),c=parseInt(a.css("height").slice(0,-2)),m=parseInt(s.css("width").slice(0,-2)),p=parseInt(s.css("height").slice(0,-2)),f=m-u,g=p-c,n=0,i=0,o.val(n),a.css({left:n+"px"}),l.val(i),a.css({top:i+"px"}),console.log(document.getElementsByClassName("choose__input")[0]),document.getElementsByClassName("choose__input")[0].checked=!0},x=function(){$(".img-upload").remove(),$(".img-watermark").remove(),$(".wrapper__img-resize").removeAttr("style"),$(".watermark__img-wrapper").removeAttr("style"),C(),$("#main-text").val(""),$("#main-file").val(""),$("#water-text").val(""),$("#water-file").val(""),$("#water-text").attr("disabled",!0),$("#water-text").addClass("ui-state-disabled"),$("#water-file").attr("disabled",!0),$("#water-file-label").addClass("ui-state-disabled"),$(".choose").addClass("ui-state-disabled"),$(".choose__input").attr("disabled",!0),$(".btn_submit").addClass("ui-state-disabled"),$(".move__input").addClass("ui-state-disabled"),$(".arrow__controls").addClass("ui-state-disabled"),document.getElementsByClassName("ui-slider-handle")[1].style.left="100%",document.getElementsByClassName("ui-slider-range")[0].style.width="100%";for(var e=document.getElementsByClassName("choose__input"),t=0;t<e.length;t++)e[t].checked=!1;n=0,i=0,o.val(n),l.val(i),a.css({left:n+"px"}),a.css({top:i+"px"}),a.css({opacity:"1"})},y=function(){$(".slider").slider({disabled:!1})},C=function(){$(".slider").slider({range:!0,disabled:!0,min:parseInt($(".slider").data("min")),max:parseInt($(".slider").data("max")),step:.01,values:[0,1]});var e=document.getElementsByClassName("ui-slider-range"),t=document.getElementsByClassName("ui-slider-handle"),a=1,s=$("#blockToMove");t[1].onmousedown=function(){var t;return t=window.setInterval(function(){a=e[0].style.width.slice(0,-1)/100,s.css({opacity:a})},50),document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a=e[0].style.width.slice(0,-1)/100,s.css({opacity:a}),clearTimeout(t)},!1}},I=function(e){e.preventDefault();var t=$(this),a=t.val();$("#main-text").val(a.replace(/C:\\fakepath\\/,""))},k=function(e){e.preventDefault();var t=$(this),a=t.val();$("#water-text").val(a.replace(/C:\\fakepath\\/,""))},B=function(e){var t=$(this),s=t.data("coord"),o=parseInt(t.val());isNaN(o)&&(o=0),t.val(o),"x"===s&&(0>o?t.val(0):o>f&&t.val(f),o=t.val(),n=parseInt(o),a.css({left:n+"px"})),"y"===s&&(0>o?t.val(0):o>g&&t.val(g),o=t.val(),i=parseInt(o),a.css({top:i+"px"}))},M=function(e){var t=$(this),s=t.data("x"),r=t.data("y");1===s&&(n=0),1===r&&(i=0),2===s&&(n=Math.floor(f/2)),2===r&&(i=Math.floor(g/2)),3===s&&(n=f),3===r&&(i=g),o.val(n),a.css({left:n+"px"}),l.val(i),a.css({top:i+"px"})},E=function(){var t=document.getElementById("blockToMove"),a=document.getElementById("dragWrapper"),s=e(a);t.onmousedown=function(a){var r=e(t),d=a.pageX-r.left,u=a.pageY-r.top;document.onmousemove=function(e){n=e.pageX-d-s.left,i=e.pageY-u-s.top,0>n&&(n=0),n>f&&(n=f),0>i&&(i=0),i>g&&(i=g),n=Math.floor(n),i=Math.floor(i),t.style.left=n+"px",t.style.top=i+"px",o.val(n),l.val(i)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},t.ondragstart=function(){return!1}},N=function(){for(var e,a,s=document.getElementsByClassName("arrow__controls"),n=0;n<s.length;n++)s[n].onclick=function(e){e.preventDefault(),t($(this))},s[n].onmousedown=function(s){s.preventDefault();var n=$(this);e=window.setTimeout(function(){a=window.setInterval(function(){t(n)},20)},375),document.onmouseup=function(){clearTimeout(a),clearTimeout(e),document.onmouseup=null}}};return{init:function(){v(),h()}}}();team9WatermarkGeneratorModule.init();