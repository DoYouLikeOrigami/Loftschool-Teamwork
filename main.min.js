"use strict";var team9WatermarkGeneratorModule=function(){function e(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}function t(e){var t=e.data("coord"),s=parseInt(e.data("step"));"x"===t?o+s>-1&&f+1>o+s&&(o+=s,n.val(o),a.css({left:o+"px"})):"y"===t&&i+s>-1&&v+1>i+s&&(i+=s,r.val(i),a.css({top:i+"px"}))}var a=$(".watermark__img-wrapper"),s=$(".wrapper__img-resize"),o=parseInt(a.css("left").slice(0,-2)),i=parseInt(a.css("top").slice(0,-2)),n=$(".boxBlock__controls-input-left"),r=$(".boxBlock__controls-input-top"),l=$(".move__input"),d=$(".choose__style"),u=0,c=0,p=0,m=0,f=p-u,v=m-c,g=function(){$(".btn_reset").on("click",C),$("#main-file").on("change",I),$("#water-file").on("change",k),l.on("change",B),d.on("click",M)},h=function(){E(),N(),_(),w(),$(".slider").length&&y()},_=function(){$("#main-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("#water-file").attr("disabled",!1),$(".sidebar__form-label_file").removeClass("ui-state-disabled"),$("#water-text").removeClass("ui-state-disabled")},done:function(e,t){var a=t.result.files[0],s=$("<img></img>");$(".img-upload").remove(),s.attr("src",a.url),s.addClass("img-upload"),s.fadeIn(".wrapper__img-resize"),$(".wrapper__img-resize").append(s),s.load(function(){var e=$(this).width(),t=$(this).height(),a=$(".main__content").height(),o=$(".main__content").width(),i=o/a,n=function(e,t,a){s.addClass(e),$(".wrapper__img-resize").css({height:t+"px",width:a+"px","margin-top":-t/2})};o>e&&a>t?n("",t,e):e/t>i?n("img-upload-widthR ",Math.round(o*t/e),o):n("img-upload-heightR ",a,Math.round(a*e/t)),b()})}})},w=function(){$("#water-file").fileupload({dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),url:"server/php/",add:function(e,t){t.submit(),$("input").attr("disabled",!1),$(".choose").removeClass("ui-state-disabled"),$(".btn").removeClass("ui-state-disabled"),$(".move__input").removeClass("ui-state-disabled"),$(".arrow__controls").removeClass("ui-state-disabled"),$(".arrow_top").addClass("arrow_top_hover"),$(".arrow_bot").addClass("arrow_bot_hover"),x()},done:function(e,t){var a=t.result.files[0],s=$(".watermark__img-wrapper"),o=$("<img></img>");o.attr("src",a.url),o.addClass("img-watermark"),o.fadeIn(".watermark__img-wrapper"),s.html(o),o.load(function(){var e=$(this).width(),t=$(this).height(),a=$(".wrapper__img-resize").height(),i=$(".wrapper__img-resize").width(),n=i/a,r=function(e,t,a){o.addClass(e),s.css({height:t+"px",width:a+"px"})};i>e&&a>t?r("",t,e):e/t>n?r("img-upload-widthR ",Math.round(i*t/e),i):r("img-upload-heightR ",a,Math.round(a*e/t)),b()})}})},b=function(){u=parseInt(a.css("width").slice(0,-2)),c=parseInt(a.css("height").slice(0,-2)),p=parseInt(s.css("width").slice(0,-2)),m=parseInt(s.css("height").slice(0,-2)),f=p-u,v=m-c,o=0,i=0,n.val(o),a.css({left:o+"px"}),r.val(i),a.css({top:i+"px"}),console.log(document.getElementsByClassName("choose__input")[0]),document.getElementsByClassName("choose__input")[0].checked=!0},C=function(){$(".img-upload").remove(),$(".img-watermark").remove(),$(".wrapper__img-resize").removeAttr("style"),$(".watermark__img-wrapper").removeAttr("style"),y(),$("#main-text").val(""),$("#main-file").val(""),$("#water-text").val(""),$("#water-file").val(""),$("#water-text").attr("disabled",!0),$("#water-text").addClass("ui-state-disabled"),$("#water-file").attr("disabled",!0),$("#water-file-label").addClass("ui-state-disabled"),$(".choose").addClass("ui-state-disabled"),$(".choose__input").attr("disabled",!0),$(".btn_submit").addClass("ui-state-disabled"),$(".move__input").addClass("ui-state-disabled"),$(".arrow__controls").addClass("ui-state-disabled"),$(".arrow_top").removeClass("arrow_top_hover"),$(".arrow_bot").removeClass("arrow_bot_hover"),document.getElementsByClassName("ui-slider-handle")[1].style.left="100%",document.getElementsByClassName("ui-slider-range")[0].style.width="100%";for(var e=document.getElementsByClassName("choose__input"),t=0;t<e.length;t++)e[t].checked=!1;o=0,i=0,n.val(o),r.val(i),a.css({left:o+"px"}),a.css({top:i+"px"}),a.css({opacity:"1"})},x=function(){$(".slider").slider({disabled:!1})},y=function(){$(".slider").slider({range:!0,disabled:!0,min:parseInt($(".slider").data("min")),max:parseInt($(".slider").data("max")),step:.01,values:[0,1]});var e=document.getElementsByClassName("ui-slider-range"),t=document.getElementsByClassName("ui-slider-handle"),a=1,s=$("#blockToMove");t[1].onmousedown=function(){var t;return t=window.setInterval(function(){a=e[0].style.width.slice(0,-1)/100,s.css({opacity:a})},50),document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a=e[0].style.width.slice(0,-1)/100,s.css({opacity:a}),clearTimeout(t)},!1}},I=function(e){e.preventDefault();var t=$(this),a=t.val();$("#main-text").val(a.replace(/C:\\fakepath\\/,""))},k=function(e){e.preventDefault();var t=$(this),a=t.val();$("#water-text").val(a.replace(/C:\\fakepath\\/,""))},B=function(e){var t=$(this),s=t.data("coord"),n=parseInt(t.val());isNaN(n)&&(n=0),t.val(n),"x"===s&&(0>n?t.val(0):n>f&&t.val(f),n=t.val(),o=parseInt(n),a.css({left:o+"px"})),"y"===s&&(0>n?t.val(0):n>v&&t.val(v),n=t.val(),i=parseInt(n),a.css({top:i+"px"}))},M=function(e){var t=$(this),s=t.data("x"),l=t.data("y");1===s&&(o=0),1===l&&(i=0),2===s&&(o=Math.floor(f/2)),2===l&&(i=Math.floor(v/2)),3===s&&(o=f),3===l&&(i=v),n.val(o),a.css({left:o+"px"}),r.val(i),a.css({top:i+"px"})},E=function(){var t=document.getElementById("blockToMove"),a=document.getElementById("dragWrapper"),s=e(a);t.onmousedown=function(a){var l=e(t),d=a.pageX-l.left,u=a.pageY-l.top;document.onmousemove=function(e){o=e.pageX-d-s.left,i=e.pageY-u-s.top,0>o&&(o=0),o>f&&(o=f),0>i&&(i=0),i>v&&(i=v),o=Math.floor(o),i=Math.floor(i),t.style.left=o+"px",t.style.top=i+"px",n.val(o),r.val(i)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},t.ondragstart=function(){return!1}},N=function(){for(var e,a,s=document.getElementsByClassName("arrow__controls"),o=0;o<s.length;o++)s[o].onclick=function(e){e.preventDefault(),t($(this))},s[o].onmousedown=function(s){s.preventDefault();var o=$(this);e=window.setTimeout(function(){a=window.setInterval(function(){t(o)},20)},375),document.onmouseup=function(){clearTimeout(a),clearTimeout(e),document.onmouseup=null}}};return{init:function(){g(),h()}}}();team9WatermarkGeneratorModule.init();